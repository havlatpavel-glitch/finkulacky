<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>P≈ôevod mƒõn</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --bg: #0e0e10;
    --surface: #17171a;
    --border: #2a2a30;
    --accent: #c8f060;
    --accent2: #60d4f0;
    --text: #e8e8ec;
    --muted: #6a6a78;
    --error: #f06060;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 2rem;
    background-image:
      radial-gradient(ellipse 60% 40% at 20% 20%, rgba(200,240,96,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 50% 50% at 80% 80%, rgba(96,212,240,0.06) 0%, transparent 60%);
  }

  .card {
    width: 100%;
    max-width: 700px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2.5rem;
    box-shadow: 0 0 80px rgba(0,0,0,0.6);
    position: relative;
    overflow: hidden;
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
  }

  h1 {
    font-family: 'Playfair Display', serif;
    font-size: 1.8rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    margin-bottom: 0.3rem;
    background: linear-gradient(135deg, var(--text), var(--muted));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .subtitle {
    font-size: 0.72rem;
    color: var(--muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 2.5rem;
  }

  .row {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1rem;
    align-items: flex-end;
  }

  .field {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  label {
    font-size: 0.68rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
  }

  input[type="number"], select {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 1rem;
    padding: 0.7rem 0.9rem;
    border-radius: 3px;
    width: 100%;
    outline: none;
    transition: border-color 0.2s;
    -moz-appearance: textfield;
  }

  input[type="number"]:focus, select:focus { border-color: var(--accent); }
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; }

  select {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236a6a78' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.9rem center;
    padding-right: 2.5rem;
  }

  .swap-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-bottom: 2px;
    transition: all 0.25s;
    font-size: 1rem;
  }

  .swap-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    transform: rotate(180deg);
  }

  .result-box {
    background: var(--bg);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    padding: 1.2rem 1rem;
    border-radius: 3px;
    margin-top: 0.5rem;
    min-height: 70px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 0.3rem;
  }

  .result-label {
    font-size: 0.65rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .result-value {
    font-size: 2rem;
    font-weight: 500;
    color: var(--accent);
    letter-spacing: -0.02em;
  }

  .result-rate {
    font-size: 0.72rem;
    color: var(--muted);
    margin-top: 0.1rem;
  }

  /* CHART */
  .chart-section {
    margin-top: 2rem;
    border-top: 1px solid var(--border);
    padding-top: 1.5rem;
  }

  .chart-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .chart-title {
    font-size: 0.72rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .period-btns {
    display: flex;
    gap: 0.3rem;
    flex-wrap: wrap;
  }

  .period-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    padding: 0.3rem 0.6rem;
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.15s;
    letter-spacing: 0.05em;
  }

  .period-btn:hover { border-color: var(--accent); color: var(--accent); }

  .period-btn.active {
    background: var(--accent);
    border-color: var(--accent);
    color: var(--bg);
    font-weight: 500;
  }

  .chart-wrap {
    position: relative;
    height: 210px;
    width: 100%;
  }

  .chart-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.72rem;
    color: var(--muted);
    letter-spacing: 0.08em;
    background: var(--surface);
    z-index: 10;
    transition: opacity 0.3s;
  }

  .chart-overlay.hidden { opacity: 0; pointer-events: none; }

  .chart-stats {
    display: flex;
    gap: 1.5rem;
    margin-top: 1rem;
    flex-wrap: wrap;
  }

  .stat { display: flex; flex-direction: column; gap: 0.15rem; }

  .stat-label {
    font-size: 0.62rem;
    color: var(--muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  .stat-value { font-size: 0.85rem; color: var(--text); }
  .stat-value.up   { color: var(--accent); }
  .stat-value.down { color: var(--error); }

  /* STATUS */
  .status-bar {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1.5rem;
    font-size: 0.65rem;
    color: var(--muted);
    letter-spacing: 0.06em;
  }

  .dot { width:6px; height:6px; border-radius:50%; background:var(--muted); flex-shrink:0; }
  .dot.live  { background:var(--accent); animation: pulse 2s infinite; }
  .dot.error { background:var(--error); }

  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.3} }

  .loading { opacity:.4; font-style:italic; }

  @media (max-width:520px) {
    .card { padding:1.5rem; }
    .result-value { font-size:1.5rem; }
    .chart-wrap { height:160px; }
  }

/* ‚îÄ‚îÄ LIGHT MODE ‚îÄ‚îÄ */
:root.light {
  --bg:       #f2f2ed;
  --surface:  #ffffff;
  --surface2: #f7f7f3;
  --border:   #deded6;
  --accent:   #527a00;
  --accent2:  #006e96;
  --accent3:  #a04c00;
  --accent4:  #5c32b0;
  --text:     #18181c;
  --muted:    #808088;
  --error:    #cc2200;
}
:root.light body {
  background-image:
    radial-gradient(ellipse 50% 40% at 10% 10%, rgba(82,122,0,0.05) 0%, transparent 60%),
    radial-gradient(ellipse 40% 50% at 90% 90%, rgba(0,110,150,0.04) 0%, transparent 60%);
  transition: background 0.3s, color 0.3s;
}
:root.light .card { box-shadow: 0 2px 16px rgba(0,0,0,0.07); }
:root.light input, :root.light select { transition: background 0.3s, border-color 0.2s; }
</style>
<script>
(function(){
  var s = localStorage.getItem('theme');
  var light = s ? s === 'light' : true;
  if (light) document.documentElement.classList.add('light');
})();
</script>
</head>
<body>
<div class="card">
  <h1>P≈ôevodn√≠k mƒõn</h1>
  <p class="subtitle">Aktu√°ln√≠ kurzy ¬∑ Historick√Ω graf</p>

  <div class="row">
    <div class="field">
      <label>ƒå√°stka</label>
      <input type="number" id="amount" value="100" min="0" step="any">
    </div>
    <div class="field">
      <label>Z mƒõny</label>
      <select id="from"></select>
    </div>
    <button class="swap-btn" id="swap" title="Prohodit mƒõny">‚áÑ</button>
    <div class="field">
      <label>Na mƒõnu</label>
      <select id="to"></select>
    </div>
  </div>

  <div class="result-box">
    <div class="result-label">V√Ωsledek</div>
    <div class="result-value loading" id="result">Naƒç√≠t√°m kurzy‚Ä¶</div>
    <div class="result-rate" id="rate"></div>
  </div>

  <div class="chart-section">
    <div class="chart-header">
      <span class="chart-title" id="chart-title">V√Ωvoj kurzu</span>
      <div class="period-btns" id="period-btns">
        <button class="period-btn" data-period="1D">1D</button>
        <button class="period-btn active" data-period="7D">7D</button>
        <button class="period-btn" data-period="1M">1M</button>
        <button class="period-btn" data-period="1Y">1Y</button>
        <button class="period-btn" data-period="5Y">5Y</button>
        <button class="period-btn" data-period="10Y">10Y</button>
      </div>
    </div>

    <div class="chart-wrap">
      <div class="chart-overlay" id="chart-overlay">Naƒç√≠t√°m historick√° data‚Ä¶</div>
      <canvas id="myChart"></canvas>
    </div>

    <div class="chart-stats" id="chart-stats"></div>
  </div>

  <div class="status-bar">
    <div class="dot" id="dot"></div>
    <span id="status">P≈ôipojuji se k API‚Ä¶</span>
  </div>
</div>

<script>
const CURRENCIES = ['USD','EUR','CZK','GBP','CHF','JPY','CAD','AUD','PLN','HUF','SEK','NOK','DKK','TRY','CNY','RON','BGN'];

let rates = {};
let activePeriod = '7D';
let chartInstance = null;

const $ = id => document.getElementById(id);

function populateSelects() {
  CURRENCIES.forEach(c => {
    $('from').innerHTML += `<option value="${c}">${c}</option>`;
    $('to').innerHTML   += `<option value="${c}">${c}</option>`;
  });
  $('from').value = 'USD';
  $('to').value   = 'CZK';
}

async function fetchRates() {
  try {
    const res  = await fetch('https://api.frankfurter.app/latest?base=EUR&symbols=' + CURRENCIES.join(','));
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    rates = data.rates;
    rates['EUR'] = 1;
    $('dot').className = 'dot live';
    $('status').textContent = `Kurzy aktualizov√°ny ¬∑ ${new Date().toLocaleTimeString('cs-CZ')}`;
    convert();
  } catch(e) {
    $('dot').className = 'dot error';
    $('status').textContent = 'Chyba naƒç√≠t√°n√≠ kurzu ¬∑ ' + e.message;
    $('result').textContent = '‚Äî';
    $('result').className = 'result-value';
  }
}

function convert() {
  const amount = parseFloat($('amount').value);
  const from   = $('from').value;
  const to     = $('to').value;
  if (isNaN(amount) || !rates[from] || !rates[to]) return;

  const result  = (amount / rates[from]) * rates[to];
  const oneUnit = rates[to] / rates[from];
  const dec     = (to === 'JPY' || to === 'HUF') ? 0 : 4;

  $('result').textContent = new Intl.NumberFormat('cs-CZ', {
    style:'currency', currency:to, maximumFractionDigits:dec
  }).format(result);
  $('result').className = 'result-value';
  $('rate').textContent = `1 ${from} = ${oneUnit.toFixed(4)} ${to}`;
}

function isoDate(d) { return d.toISOString().split('T')[0]; }

function getRange(period) {
  const to   = new Date();
  const from = new Date();
  if      (period === '1D')  from.setDate(from.getDate() - 5);   // API needs some days window; use 5 for 1D
  else if (period === '7D')  from.setDate(from.getDate() - 7);
  else if (period === '1M')  from.setMonth(from.getMonth() - 1);
  else if (period === '1Y')  from.setFullYear(from.getFullYear() - 1);
  else if (period === '5Y')  from.setFullYear(from.getFullYear() - 5);
  else if (period === '10Y') from.setFullYear(from.getFullYear() - 10);
  return { from: isoDate(from), to: isoDate(to) };
}

async function fetchHistory() {
  const from = $('from').value;
  const to   = $('to').value;

  const overlay = $('chart-overlay');
  overlay.textContent = 'Naƒç√≠t√°m historick√° data‚Ä¶';
  overlay.classList.remove('hidden');
  $('chart-stats').innerHTML = '';

  if (from === to) {
    overlay.textContent = 'Stejn√° mƒõna ‚Äî vyberte r≈Øzn√© mƒõny.';
    return;
  }

  const { from: startDate, to: endDate } = getRange(activePeriod);
  const url = `https://api.frankfurter.app/${startDate}..${endDate}?base=${from}&symbols=${to}`;

  try {
    const res  = await fetch(url);
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();

    let labels = Object.keys(data.rates).sort();
    let values = labels.map(d => data.rates[d][to]);

    // For 1D keep only last 2 points (yesterday + today)
    if (activePeriod === '1D' && labels.length > 2) {
      labels = labels.slice(-2);
      values = values.slice(-2);
    }

    renderChart(labels, values, from, to);
    renderStats(values, from, to);
  } catch(e) {
    overlay.textContent = 'Nepoda≈ôilo se naƒç√≠st data: ' + e.message;
  }
}

function renderChart(labels, values, from, to) {
  const overlay = $('chart-overlay');
  overlay.classList.add('hidden');

  const ctx = $('myChart').getContext('2d');
  if (chartInstance) chartInstance.destroy();

  if (!labels.length) {
    overlay.textContent = '≈Ω√°dn√° data pro toto obdob√≠.';
    overlay.classList.remove('hidden');
    return;
  }

  const isUp       = values[values.length - 1] >= values[0];
  const lineColor  = isUp ? '#c8f060' : '#f06060';
  const grad       = ctx.createLinearGradient(0, 0, 0, 210);
  grad.addColorStop(0, isUp ? 'rgba(200,240,96,0.22)' : 'rgba(240,96,96,0.22)');
  grad.addColorStop(1, 'rgba(14,14,16,0)');

  // Sparse x-axis labels
  const maxL = 7;
  const step = Math.max(1, Math.ceil(labels.length / maxL));
  const xLabels = labels.map((l, i) =>
    (i === 0 || i === labels.length - 1 || i % step === 0) ? l : ''
  );

  chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: xLabels,
      datasets: [{
        data: values,
        borderColor: lineColor,
        borderWidth: 1.8,
        backgroundColor: grad,
        pointRadius: 0,
        pointHoverRadius: 5,
        pointHoverBackgroundColor: lineColor,
        pointHoverBorderColor: '#0e0e10',
        pointHoverBorderWidth: 2,
        tension: 0.3,
        fill: true,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#17171a',
          borderColor: '#2a2a30',
          borderWidth: 1,
          titleColor: '#6a6a78',
          bodyColor: '#e8e8ec',
          titleFont: { family: 'DM Mono', size: 11 },
          bodyFont: { family: 'DM Mono', size: 13 },
          callbacks: {
            title: ctx => labels[ctx[0].dataIndex],
            label: ctx => ` 1 ${from} = ${ctx.parsed.y.toFixed(4)} ${to}`,
          }
        }
      },
      scales: {
        x: {
          grid:   { color: 'rgba(255,255,255,0.035)' },
          ticks:  { color: '#6a6a78', font: { family:'DM Mono', size:10 }, maxRotation:0, autoSkip:false },
          border: { color: '#2a2a30' }
        },
        y: {
          grid:   { color: 'rgba(255,255,255,0.035)' },
          ticks:  { color: '#6a6a78', font: { family:'DM Mono', size:10 }, maxTicksLimit:5 },
          border: { color: '#2a2a30' }
        }
      }
    }
  });

  $('chart-title').textContent = `${from} / ${to} ¬∑ ${activePeriod}`;
}

function renderStats(values) {
  if (values.length < 2) return;
  const first = values[0];
  const last  = values[values.length - 1];
  const min   = Math.min(...values);
  const max   = Math.max(...values);
  const chg   = last - first;
  const pct   = ((chg / first) * 100).toFixed(2);
  const isUp  = chg >= 0;

  $('chart-stats').innerHTML = `
    <div class="stat">
      <div class="stat-label">Aktu√°ln√≠</div>
      <div class="stat-value">${last.toFixed(4)}</div>
    </div>
    <div class="stat">
      <div class="stat-label">Zmƒõna (${activePeriod})</div>
      <div class="stat-value ${isUp ? 'up' : 'down'}">${isUp ? '‚ñ≤' : '‚ñº'} ${Math.abs(chg).toFixed(4)} (${Math.abs(pct)}%)</div>
    </div>
    <div class="stat">
      <div class="stat-label">Min</div>
      <div class="stat-value">${min.toFixed(4)}</div>
    </div>
    <div class="stat">
      <div class="stat-label">Max</div>
      <div class="stat-value">${max.toFixed(4)}</div>
    </div>
  `;
}

// Events
$('swap').addEventListener('click', () => {
  const tmp = $('from').value;
  $('from').value = $('to').value;
  $('to').value = tmp;
  convert();
  fetchHistory();
});

$('amount').addEventListener('input', convert);
$('from').addEventListener('change', () => { convert(); fetchHistory(); });
$('to').addEventListener('change',   () => { convert(); fetchHistory(); });

$('period-btns').addEventListener('click', e => {
  if (!e.target.dataset.period) return;
  document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
  e.target.classList.add('active');
  activePeriod = e.target.dataset.period;
  fetchHistory();
});

// Init
populateSelects();
fetchRates();
fetchHistory();
setInterval(fetchRates, 60000);
</script>

<style>
.theme-toggle-btn {
  position: fixed; top: 1rem; right: 1rem; z-index: 100;
  display: flex; align-items: center; gap: 0.5rem;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 50px; padding: 0.35rem 0.75rem 0.35rem 0.55rem;
  cursor: pointer; font-family: 'DM Mono', monospace;
  font-size: 0.62rem; letter-spacing: 0.1em; text-transform: uppercase;
  color: var(--muted); transition: border-color 0.2s, background 0.3s;
  box-shadow: 0 2px 12px var(--shadow, rgba(0,0,0,0.3));
  text-decoration: none;
}
.theme-toggle-btn:hover { border-color: var(--accent); color: var(--text); }
.toggle-track {
  width: 28px; height: 16px; border-radius: 8px;
  background: var(--border); position: relative; transition: background 0.3s; flex-shrink: 0;
}
:root.light .toggle-track { background: var(--accent); }
.toggle-thumb {
  position: absolute; top: 2px; left: 2px;
  width: 12px; height: 12px; border-radius: 50%;
  background: var(--muted); transition: transform 0.3s, background 0.3s;
}
:root.light .toggle-thumb { transform: translateX(12px); background: #fff; }
</style>
<button class="theme-toggle-btn" id="calcThemeToggle">
  <div class="toggle-track"><div class="toggle-thumb"></div></div>
  <span id="calcThemeIcon">‚òÄÔ∏è</span>
</button>
<script>
(function(){
  var btn = document.getElementById('calcThemeToggle');
  var icon = document.getElementById('calcThemeIcon');
  var root = document.documentElement;
  function updateIcon() {
    icon.textContent = root.classList.contains('light') ? '‚òÄÔ∏è' : 'üåô';
  }
  updateIcon();
  btn.addEventListener('click', function(){
    var isLight = !root.classList.contains('light');
    root.classList.toggle('light', isLight);
    localStorage.setItem('theme', isLight ? 'light' : 'dark');
    updateIcon();
  });
})();
</script>

</body>
</html>
